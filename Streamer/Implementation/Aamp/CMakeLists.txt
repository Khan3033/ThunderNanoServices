cmake_minimum_required(VERSION 2.8)

set(PLAYERPLATFORM_PLUGIN_NAME PlayerPlatform)

find_package(Aamp REQUIRED)

if (AAMP_FOUND)
    find_package(GLIB REQUIRED)
    find_package(GStreamer REQUIRED)
    message("Building Aamp....")

    file(GLOB PLAYERPLATFORM_PLUGIN_INCLUDES *.h)

    set(PLAYERPLATFORM_PLUGIN_DEFINITIONS )
    set(PLAYERPLATFORM_PLUGIN_INCLUDE_DIRS ${CMAKE_CURRENT_SOURCE_DIR} ${GLIB_INCLUDE_DIRS} ${GSTREAMER_INCLUDE_DIRS})
    set(PLAYERPLATFORM_PLUGIN_SOURCES PlayerImplementation.cpp)
    set(PLAYERPLATFORM_PLUGIN_LIBS ${GLIB_GIO_LIBRARIES} ${GLIB_LIBRARIES} ${GSTREAMER_LIBRARIES})

    set(ADDITIONAL_LIBRARIES ${PLAYERPLATFORM_PLUGIN_LIBS} PARENT_SCOPE)
    set(ADDITIONAL_INCLUDE_DIRS ${PLAYERPLATFORM_PLUGIN_INCLUDE_DIRS} PARENT_SCOPE)

    # add the library
    add_library(${PLAYERPLATFORM_PLUGIN_NAME} STATIC ${PLAYERPLATFORM_PLUGIN_SOURCES})
    target_compile_definitions(${PLAYERPLATFORM_PLUGIN_NAME} PRIVATE ${PLAYERPLATFORM_PLUGIN_DEFINITIONS})
    target_include_directories(${PLAYERPLATFORM_PLUGIN_NAME} PRIVATE ${PLAYERPLATFORM_PLUGIN_INCLUDE_DIRS})
    target_link_libraries(${PLAYERPLATFORM_PLUGIN_NAME} ${PLAYERPLATFORM_PLUGIN_LIBS})
    set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -fPIC")

    install(TARGETS ${PLAYERPLATFORM_PLUGIN_NAME} DESTINATION ${CMAKE_INSTALL_PREFIX}/lib/)
endif()
